<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Un Regalo para T칤a Maca</title>
    <style>
        :root {
            --color-primario: #8e4a8c;
            --color-secundario: #f3d5f2;
            --color-terciario: #d8a3d6;
            --color-texto: #3a2a3a;
            --color-fondo: #fff5fe;
            --color-carta: #fef7fe;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--color-fondo);
            color: var(--color-texto);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
            touch-action: manipulation;
            line-height: 1.6;
            -webkit-text-size-adjust: 100%;
        }

        .contenedor-regalo {
            width: 100%;
            max-width: 400px;
            perspective: 1200px;
            position: relative;
        }

        .carta {
            width: 100%;
            height: 0;
            padding-bottom: 133.33%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.25, 0.1, 0.25, 1);
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(142, 74, 140, 0.2);
            background: var(--color-carta);
            border: 1px solid var(--color-terciario);
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .portada, .contenido {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            overflow: hidden;
            background: var(--color-carta);
        }

        .contenido {
            transform: rotateY(180deg);
            justify-content: space-between;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .carta.abierta {
            transform: rotateY(180deg);
        }

        h1 {
            color: var(--color-primario);
            font-size: 1.8rem;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
        }

        p, li {
            margin-bottom: 15px;
            font-size: 1rem;
            line-height: 1.7;
            color: var(--color-texto);
        }

        .firma {
            font-style: italic;
            text-align: right;
            margin-top: 20px;
            color: var(--color-primario);
            font-weight: 600;
            width: 100%;
            font-size: 1.2rem;
        }

        .sello {
            width: 60px;
            height: 60px;
            background: var(--color-secundario);
            border: 3px dashed var(--color-terciario);
            border-radius: 50%;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        .btn-volver {
            background: linear-gradient(to bottom, var(--color-primario) 0%, #6d3a6b 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 20px;
            width: 80%;
            max-width: 200px;
            -webkit-appearance: none;
            appearance: none;
            position: relative; /* Para asegurar el z-index */
            z-index: 10; /* Para que est칠 por encima de otros elementos */
        }

        .flor {
            font-size: 3rem;
            margin: 15px 0;
            color: var(--color-primario);
        }

        .mensaje-inicial {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 245, 254, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            padding: 20px;
        }

        .btn-empezar {
            background: linear-gradient(to bottom, var(--color-primario) 0%, #6d3a6b 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
            -webkit-appearance: none;
            appearance: none;
        }

        /* Animaciones */
        @media (prefers-reduced-motion: no-preference) {
            .carta {
                transition: transform 0.6s cubic-bezier(0.25, 0.1, 0.25, 1);
            }
            
            .flor {
                animation: latido 4s infinite ease-in-out;
            }
            
            @keyframes latido {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.15); }
            }
            
            .mensaje-inicial {
                transition: opacity 0.5s ease;
            }
            
            .btn-volver {
                transition: all 0.3s ease;
            }
            
            .btn-volver:active {
                transform: scale(0.95);
                opacity: 0.9;
            }
        }

        /* Modo oscuro */
        @media (prefers-color-scheme: dark) {
            :root {
                --color-primario: #e8b3e6;
                --color-secundario: #3a2a3a;
                --color-terciario: #9c6b9a;
                --color-texto: #f8e6f7;
                --color-fondo: #2a1a2a;
                --color-carta: #3a2a3a;
            }
            
            .mensaje-inicial {
                background-color: rgba(42, 26, 42, 0.95);
            }
        }

        /* Ajustes espec칤ficos para iOS */
        @supports (-webkit-touch-callout: none) {
            body {
                -webkit-font-smoothing: antialiased;
            }
            
            .contenido {
                padding-bottom: constant(safe-area-inset-bottom);
                padding-bottom: env(safe-area-inset-bottom);
            }
            
            .btn-volver {
                padding: 14px 28px; /* M치s grande para iOS */
            }
        }
    </style>
</head>
<body>
    <div class="mensaje-inicial" id="mensajeInicial">
        <h2>Un regalo especial para Mi, t칤a Maca</h2>
        <div class="flor">游꺚</div>
        <button class="btn-empezar" id="btnEmpezar">Abrir regalo</button>
    </div>
    
    <div class="contenedor-regalo">
        <div class="carta" id="carta">
            <div class="portada">
                <h1>Para mi Querida T칤a Maca</h1>
                <div class="flor">游눘</div>
                <div class="sello" id="btnAbrir">游눏</div>
                <p>Toca el sobre para abrir tu regalo</p>
            </div>
            
            <div class="contenido" id="contenido">
                <p>Mi querida t칤a Maca,</p>
                <p>En este d칤a quiero expresarte lo especial que eres para m칤. Su amor incondicional, Su sabidur칤a y Su alegr칤a contagiosa hacen que cada momento a Su lado sea un verdadero regalo.</p>
                <p>Recuerdo con cari침o todas esas veces que...</p>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    <li>Me consolo cuando estaba triste</li>
                    <li>Me aconsejo</li>
                </ul>
                <p>Usted es un faro de luz en nuestra familia y hoy quiero que sepa lo profundamente agradecido que estoy por tenerte como mi tia.</p>
                <p class="firma">Con todo mi cari침o,<br>Su sobrino Diego</p>
                <div class="flor">游꺛</div>
                
                <!-- Bot칩n "Volver" mejorado -->
                <button class="btn-volver" id="btnVolver">Volver</button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            'use strict';
            
            // Detecci칩n mejorada de plataforma
            const isAndroid = /Android/i.test(navigator.userAgent);
            const isIOS = /iPad|iPhone|iPod/i.test(navigator.userAgent);
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            
            // Elementos del DOM
            const carta = document.getElementById('carta');
            const btnAbrir = document.getElementById('btnAbrir');
            const btnVolver = document.getElementById('btnVolver');
            const mensajeInicial = document.getElementById('mensajeInicial');
            const btnEmpezar = document.getElementById('btnEmpezar');
            
            // Funci칩n para iniciar
            function iniciarRegalo(e) {
                if (isTouchDevice && e.cancelable) e.preventDefault();
                mensajeInicial.style.opacity = '0';
                setTimeout(() => {
                    mensajeInicial.style.display = 'none';
                }, 500);
            }
            
            // Funci칩n para abrir la carta
            function abrirCarta(e) {
                if (isTouchDevice && e.cancelable) e.preventDefault();
                carta.classList.add('abierta');
                
                if (isTouchDevice && navigator.vibrate) {
                    navigator.vibrate(10); // Vibraci칩n m치s corta
                }
            }
            
            // FUNCI칍N VOLVER MEJORADA (100% FUNCIONAL)
            function volverCarta(e) {
                // Prevenir comportamiento por defecto
                if (e.cancelable) e.preventDefault();
                
                // M칠todo universal que funciona en todos los dispositivos
                carta.style.transform = 'rotateY(0deg)';
                
                // Reset despu칠s de la animaci칩n
                setTimeout(() => {
                    carta.classList.remove('abierta');
                    carta.style.transform = '';
                }, 600);
                
                // Feedback t치ctil mejorado
                if (isTouchDevice && navigator.vibrate) {
                    navigator.vibrate(10);
                }
                
                // Asegurar que el bot칩n est칠 habilitado
                btnVolver.disabled = false;
            }
            
            // Configuraci칩n de eventos robusta
            function setupEventListeners() {
                // Pantalla inicial
                btnEmpezar.addEventListener('click', iniciarRegalo);
                if (isTouchDevice) {
                    btnEmpezar.addEventListener('touchstart', iniciarRegalo, { passive: false });
                }
                
                // Abrir carta
                btnAbrir.addEventListener('click', abrirCarta);
                if (isTouchDevice) {
                    btnAbrir.addEventListener('touchstart', abrirCarta, { passive: false });
                }
                
                // VOLVER - IMPLEMENTACI칍N DEFINITIVA
                // Evento principal para todos los dispositivos
                btnVolver.addEventListener('click', volverCarta);
                
                // Eventos t치ctiles adicionales para m치xima compatibilidad
                if (isTouchDevice) {
                    // Touchstart para Android y iOS
                    btnVolver.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        btnVolver.style.opacity = '0.8'; // Feedback visual
                        volverCarta(e);
                    }, { passive: false });
                    
                    // Touchend para resetear estilos
                    btnVolver.addEventListener('touchend', function() {
                        btnVolver.style.opacity = '1';
                    }, { passive: true });
                    
                    // Prevenir zoom en iOS
                    if (isIOS) {
                        btnVolver.addEventListener('gesturestart', function(e) {
                            e.preventDefault();
                        }, { passive: false });
                    }
                }
            }
            
            // Inicializaci칩n optimizada
            function init() {
                setupEventListeners();
                
                // Ajustes espec칤ficos para Android
                if (isAndroid) {
                    // Forzar aceleraci칩n por hardware
                    carta.style.willChange = 'transform';
                    btnVolver.style.willChange = 'transform';
                }
                
                // Ajustes para iOS
                if (isIOS) {
                    // Mejorar rendimiento t치ctil
                    document.body.style.webkitTouchCallout = 'none';
                }
            }
            
            // Inicio seguro
            if (document.readyState !== 'loading') {
                init();
            } else {
                document.addEventListener('DOMContentLoaded', init);
            }
        })();
    </script>
</body>
</html>
